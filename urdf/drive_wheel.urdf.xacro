<?xml version="1.0"?>
<!-- Guidebot differential drive base -->

<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <gazebo reference="drive_wheel_link">
    <material>Gazebo/Black</material>
    <!-- <kp>1000000.0</kp>
    <kd>100.0</kd> -->
    <mu1>1</mu1>
    <mu2>1</mu2>
    <fdir1>1 1 1</fdir1>
    <minDepth>0.003</minDepth>
    <maxVel>1.0</maxVel>
  </gazebo>

  <gazebo reference="steer_link">
    <material>Gazebo/SkyBlue</material>
  </gazebo>

  <!-- Wheel Assembly -->
  <xacro:macro name="drive_wheel_assembly">

    <xacro:property name="dynamixel_effort" value="1000"/>
    <xacro:property name="dynamixel_velocity" value="4.0"/>

    <!-- Wheel characteristics -->
    <xacro:property name="wheel_radius" value="0.110"/>
    <xacro:property name="wheel_width" value="0.070"/>

    <!-- Wheel-->
    <joint name="drive_wheel_joint" type="continuous">
      <origin xyz="0 0 0" rpy="${-M_PI/2} 0 0"/>
      <axis xyz="0 0 1"/>
      <limit effort="${dynamixel_effort*500}" velocity="${dynamixel_velocity*100}"/>
      <dynamics damping="0.0" friction="0.0"/>
      <parent link="steer_link"/>
      <child link="drive_wheel_link"/>
    </joint>

    <xacro:simple_transmission name="drive_wheel_joint" interface="VelocityJointInterface"/>

    <link name="drive_wheel_link">
      <inertial>
        <mass value="5"/>
        <origin xyz="0 0 0"/>
        <cylinder_inertia m="5" r="${wheel_radius}" h="${wheel_width}"/>
      </inertial>
      <visual>
        <geometry>
          <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
        </geometry>
        <!-- <material name="DarkGrey"/> -->
      </visual>
      <collision>
        <geometry>
          <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
        </geometry>
      </collision>
    </link>

    <!-- Wheel Steer -->
    <joint name="steer_joint" type="revolute">
      <axis xyz="0 0 1"/>
      <limit lower="${-90*M_PI/180.0}" upper="${90*M_PI/180.0}" effort="${dynamixel_effort}" velocity="${dynamixel_velocity}"/>
      <dynamics damping="0.0" friction="0.0"/>
      <origin xyz="1.043 0 ${0.110 - 0.035}" rpy="0 0 0"/>
      <parent link="base_link"/>
      <child link="steer_link"/>
    </joint>

    <xacro:simple_transmission name="steer_joint" interface="PositionJointInterface"/>

    <link name="steer_link">
      <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.1" />
          <inertia
            ixx="1.0" ixy="0.0" ixz="0.0"
            iyy="1.0" iyz="0.0"
            izz="1.0" />
      </inertial>
    </link>

  </xacro:macro>

</robot>